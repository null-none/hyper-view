document.addEventListener("DOMContentLoaded",()=>{let e={innerHTML:(e,t)=>e.innerHTML=t,beforebegin:(e,t)=>e.insertAdjacentHTML("beforebegin",t),afterend:(e,t)=>e.insertAdjacentHTML("afterend",t)},t=document.createElement("div");function r(){document.getElementById("hyperview-spinner").style.display="block"}function n(){document.getElementById("hyperview-spinner").style.display="none"}async function i(t,i=!1){let a=["hv-get","hv-post","hv-put","hv-delete"].find(e=>t.hasAttribute(e));if(!a)return;let l=a.split("-")[1].toUpperCase(),o=t.getAttribute(a),s=t.getAttribute("hv-target"),p=s?document.querySelector(s):t,d=t.getAttribute("hv-swap")||"innerHTML",h=t.getAttribute("hv-params"),v=t.hasAttribute("hv-push-url"),c=null,f={};if("FORM"===t.tagName){let g=new FormData(t),u=Object.fromEntries(g.entries());if("GET"===l){let y=new URLSearchParams(u).toString();o+=(o.includes("?")?"&":"?")+y}else c=JSON.stringify(u),f["Content-Type"]="application/json"}if(h)try{let b=JSON.parse(h);if("GET"===l){let m=new URLSearchParams(b).toString();o+=(o.includes("?")?"&":"?")+m}else c=JSON.stringify(b),f["Content-Type"]="application/json"}catch(w){console.warn("Invalid hv-params JSON")}r();try{let L=await fetch(o,{method:l,headers:f,body:c}),A=await L.text();d in e&&p&&e[d](p,A),v&&!i&&history.pushState({html:A,targetSelector:s,url:o},"",o)}catch(E){console.error("HyperView error:",E)}finally{n()}}t.innerHTML=`<div id="hyperview-spinner" style="
        position:fixed; top:10px; right:10px; padding:6px 12px;
        background:#000; color:#fff; font-size:12px;
        border-radius:6px; z-index:9999; display:none;">Loading...</div>`,document.body.appendChild(t),document.body.addEventListener("click",e=>{let t=e.target.closest("[hv-get], [hv-post], [hv-put], [hv-delete]");t&&"FORM"!==t.tagName&&(e.preventDefault(),i(t))}),document.body.addEventListener("submit",e=>{let t=e.target;t.matches("form[hv-get], form[hv-post], form[hv-put], form[hv-delete]")&&(e.preventDefault(),i(t))}),document.querySelectorAll('[hv-trigger="load"]').forEach(e=>{i(e)}),window.addEventListener("popstate",e=>{let t=e.state;if(t&&t.targetSelector&&t.html){let r=document.querySelector(t.targetSelector);r&&(r.innerHTML=t.html)}});let a=document.querySelectorAll("[hv-ws]");a.forEach(t=>{let r=t.getAttribute("hv-ws"),n=new WebSocket(r);n.onmessage=r=>{let n=t.getAttribute("hv-swap")||"innerHTML";n in e&&e[n](t,r.data)},n.onerror=e=>console.warn("WebSocket error:",e)})});